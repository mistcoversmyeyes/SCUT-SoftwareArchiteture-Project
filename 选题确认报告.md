# 选题确认报告
- **组长**：无（文档未提及）
- **组员**：无（文档未提及）

## 1. 选题与目标
我们选择实现 **OCR（Optical Character Recognition，图像文字识别）** 应用，目标是在浏览器/移动端对拍照或截图中的文字进行识别与导出，支持中英文与常见排版。该项目为计算密集且对时延敏感的应用，用户期望在1–2秒内看到识别结果。

### 1.1 核心功能
- **图片输入**：支持相机拍摄、本地上传、截图粘贴三种方式
- **预处理**：对输入图片进行旋转矫正、去噪、二值化、增强处理
- **文本检测**：定位图片中的文字区域，支持多行文字、多语言场景
- **文本识别**：按行或按块将图片中的文字识别为可编辑文本
- **后处理**：实现版面重建（段落/表格粗对齐）、文本导出（支持TXT/JSON/Markdown格式）

### 1.2 典型场景
适用于打印件、屏幕截图的文字识别需求。

## 2. 总体架构与计算划分（Browser/Mobile ↔ Server/Cloud）
为兼顾时延与精度，采用前后端协同的分层架构，明确端侧与服务端的职责分工及数据流转逻辑。

### 2.1 架构职责划分
- **端侧（Browser/Mobile）**：完成轻量级预处理、图片缩放、推理前后处理；可选运行轻量检测模型（WASM/WebGPU），并在网络较差时提供“仅端侧识别”的降级路径（低精度、快响应）。
- **服务端（Server/Cloud）**：提供标准/高精度识别（如大模型/Transformer）、版面分析与表格结构化功能；支持并发处理与批处理任务。

### 2.2 数据流
图片 → 端侧预处理/（可选）检测 → 发送ROI（感兴趣区域）/特征到服务端 → 服务端识别 → 返回文本与版面信息 → 端侧渲染与导出

### 2.3 端侧与服务端各阶段任务对比表
| 阶段       | 端侧（浏览器/移动端）       | 服务端（云/远端）           | 说明                                   |
|------------|------------------------------|------------------------------|----------------------------------------|
| 预处理     | ✓                            |                              | 降噪、缩放、纠偏，减少图片上传体积     |
| 文本检测   | ✓（轻量/可选）               | ✓（标准/高精度）             | 端侧先粗定位文字区域，服务端进行精修   |
| 文本识别   |                              | ✓                            | 采用高精度模型，支持并发优化           |
| 版面重建   | ✓（渲染呈现）                | ✓（结构推断）                | 服务端生成版面结构，端侧负责可视化呈现 |
| 导出       | ✓                            |                              | 支持TXT/JSON/Markdown格式导出          |

## 3. 源码模块结构
采用单仓多包结构，清晰区分端侧与服务端模块，同时共享协议与工具类，模块结构如下：

```
ocr-app/
├── client/                     # 端侧应用（Web/移动）
│   ├── src/
│   │   ├── pages/              # 页面/路由配置
│   │   ├── components/         # UI组件（上传、裁剪、结果展示等）
│   │   ├── pipelines/          # 端侧推理流水线（预处理、检测、后处理）
│   │   │   ├── preprocess      # 去噪、缩放、纠偏
│   │   │   ├── detect          # 轻量检测（WASM/WebGPU，可选）
│   │   │   └── postprocess     # NMS（非极大值抑制）、排序、行块合并
│   │   ├── workers/            # WebWorker/线程 offload（减轻主线程压力）
│   │   ├── wasm/               # ONNX/WASM 运行时与模型切片
│   │   ├── utils/              # 工具类（图像处理、数学计算、计时、日志）
│   │   └── services/           # 调用后端识别API的服务封装
│   └── tests/                  # 端侧单测用例
├── go-gateway/                 # Go编写的API网关
│   ├── cmd/
│   │   └── server/
│   │       └── main.go         # 服务启动入口
│   ├── internal/
│   │   ├── handlers/           # HTTP请求处理器（基于Gin/Echo框架）
│   │   ├── services/           # 业务逻辑层
│   │   └── rpc_client/         # gRPC客户端（调用Python推理服务）
│   └── pkg/                    # 项目内可共享的Go库
├── python-inference-service/   # Python编写的推理服务
│   ├── app/
│   │   ├── __init__.py
│   │   ├── server.py           # gRPC服务端启动入口
│   │   ├── services/           # 实现gRPC接口
│   │   │   ├── detector.py     # 文本检测（基于DBNet/EAST模型）
│   │   │   ├── recognizer.py   # 文本识别（基于CRNN/TrOCR模型）
│   │   │   └── layout.py       # 版面分析
│   │   ├── models/             # 模型权重（ONNX/FP16/INT8格式）
│   │   └── utils/              # 后处理、切片等工具类
│   ├── benchmarks/             # 压测脚本
│   └── requirements.txt        # Python依赖包清单
├── server/                     # 服务端（可选FastAPI/Flask或Node/Fastify）
│   ├── app.py                  # 启动入口（或index.ts）
│   ├── routers/
│   │   ├── infer.py            # /infer识别接口（支持批处理、并发、队列）
│   │   └── health.py           # 健康检查/指标监控接口
│   ├── services/
│   │   ├── detector.py         # 标准/高精度检测（如DBNet/EAST）
│   │   ├── recognizer.py       # 识别（如CRNN/TrOCR/ViT）
│   │   └── layout.py           # 版面结构/表格线检测
│   ├── models/                 # 模型权重（ONNX/FP16/INT8格式）
│   └── utils/                  # 后处理、切片、缓存等工具类
├── shared/                     # 共享资源
│   ├── protos/                 # Protobuf协议定义
│   │   └── ocr.proto           # 定义RPC服务和消息体
│   ├── schemas/                # 前后端协议（TypeScript types/Pydantic）
│   └── metrics/                # 指标埋点与打点约定
├── scripts/                    # 数据准备、模型量化、导出等工具脚本
├── docs/                       # 架构图、接口说明、演示清单等文档
├── go.mod                      # Go模块依赖配置
└── README.md                   # 项目说明文档
```

### 3.1 核心模块职责简述
- **client/pipelines/* **：负责端侧图像处理与可选的轻量检测，封装计时点用于性能监控。
- **server/services/* **：提供统一推理接口，支持GPU/CPU部署、批处理、并发控制、熔断与缓存机制。
- **shared/schemas**：定义请求（图片/ROI/参数）与响应（文本/坐标/版面）的结构体，确保前后端强类型对齐。
- **benchmarks**：包含压测与A/B测试脚本，输出延迟分布、吞吐率、召回率/准确率等核心指标。

## 4. 关键技术栈
### 4.1 端侧技术栈
- 开发语言与框架：TypeScript + React/Next.js
- 性能优化：WebWorker（线程拆分）、WebAssembly/WebGPU（高效计算）

### 4.2 服务端技术栈
- 开发语言与框架：Python + FastAPI（推理服务）、Go（API网关）
- 推理框架：PyTorch（模型训练与推理）

### 4.3 模型路线
- 文本检测：轻量模型（DBNet-lite/EAST）、标准/高精度模型（DBNet/EAST）
- 文本识别：CRNN、TrOCR、ViT等模型

### 4.4 质量与度量指标
- 耗时指标：端侧耗时、后端耗时（TTI、检测/识别分阶段耗时）
- 整体性能：端到端时延、网络传输体积
- 识别效果：召回率、准确率